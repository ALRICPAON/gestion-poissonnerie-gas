<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>üìà Statistiques</title>
  <link rel="stylesheet" href="../css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    /* petits ajustements locaux */
    .header-box { margin-bottom:1.2em; }
    .margin-settings { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-top:8px; }
    .search-input { margin-bottom:8px; width:100%; padding:6px; border-radius:6px; border:1px solid #ddd; }
    .totaux { margin:12px 0 18px 0; }
    table { width:100%; border-collapse:collapse; margin-bottom:18px; }
    table th, table td { text-align:left; padding:8px; border-bottom:1px solid #eee; }
    .btn-row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .small-muted { font-size:13px; color:#666; margin-top:6px; }
    .chart-wrap { max-width:100%; margin-bottom:12px; }
    .top-actions { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
  </style>
</head>

<body>

<div class="top-bar">
  <h1>üìà Statistiques</h1>
  <button class="btn btn-muted" onclick="window.location.href='/pages/home.html'">‚Üê Retour accueil</button>
</div>

<div class="header-box box">
  <h2>Filtrer la p√©riode</h2>

  <div style="display:flex; gap:10px; margin-bottom:10px;">
    <button class="btn btn-muted" data-period="day">Jour</button>
    <button class="btn btn-muted" data-period="week">Semaine</button>
    <button class="btn btn-muted" data-period="month">Mois</button>
    <button class="btn btn-muted" data-period="year">Ann√©e</button>
  </div>

  <div class="margin-settings">
    <label>Du :
      <input type="date" id="dateFrom">
    </label>

    <label>Au :
      <input type="date" id="dateTo">
    </label>

    <label>Top N :
      <input type="number" id="topN" value="10" min="1" style="width:80px; margin-left:6px">
    </label>

    <div style="margin-left:auto">
      <button class="btn btn-accent" id="btnLoad">üîç Charger</button>
      <button class="btn btn-muted" id="btnExportCSV">‚¨á Export top CA</button>
    </div>
  </div>

  <div id="status" class="small-muted">Pr√™t</div>
</div>

<!-- R√©sum√©s -->
<div class="stock-resume">
  <div class="resume-item">
    <h3>CA total</h3>
    <p id="resume-ca">0 ‚Ç¨</p>
  </div>

  <div class="resume-item">
    <h3>Achats consomm√©s</h3>
    <p id="resume-achats">0 ‚Ç¨</p>
  </div>

  <div class="resume-item total">
    <h3>Marge totale</h3>
    <p id="resume-marge">0 ‚Ç¨</p>
  </div>
</div>

<!-- FOURNISSEURS -->
<section>
  <h2>Top Fournisseurs (marge)</h2>
  <div class="top-actions">
    <input class="search-input" id="searchF" placeholder="üîç Rechercher fournisseur...">
    <button class="btn btn-muted" id="btnExportFournisseurs">‚¨á Export fournisseurs</button>
  </div>

  <div class="chart-wrap">
    <canvas id="chartFournisseurs" height="120"></canvas>
  </div>

  <table>
    <thead>
      <tr><th>Fournisseur</th><th>CA</th><th>Achats</th><th>Marge ‚Ç¨</th><th>Marge %</th></tr>
    </thead>
    <tbody id="table-fournisseurs"></tbody>
  </table>
</section>

<!-- ARTICLES -->
<section>
  <h2>Top Articles (marge)</h2>
  <div class="top-actions">
    <input class="search-input" id="searchA" placeholder="üîç Rechercher PLU ou d√©signation...">
    <button class="btn btn-muted" id="btnExportArticles">‚¨á Export articles</button>
  </div>

  <div class="chart-wrap">
    <canvas id="chartArticles" height="120"></canvas>
  </div>

  <table>
    <thead>
      <tr><th>PLU</th><th>D√©signation</th><th>CA</th><th>Achats</th><th>Marge ‚Ç¨</th><th>Marge %</th></tr>
    </thead>
    <tbody id="table-articles"></tbody>
  </table>
</section>

<script type="module" src="../js/compta-stats.js"></script>
</body>
</html>
