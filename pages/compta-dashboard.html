<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Tableau de bord ‚Äì Comptabilit√©</title>
  <link rel="stylesheet" href="../css/style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <style>
    .box { background:var(--bg-box); padding:1em; border-radius:var(--radius);
           box-shadow:var(--shadow); border:1px solid var(--border); margin-bottom:1.2em; }
    .row { display:flex; gap:1em; flex-wrap:wrap; align-items:end; }
    .row > label { display:flex; flex-direction:column; font-weight:600; font-size:14px; color:var(--text-main); }
    .row input, .row select { padding:0.5em; border:1px solid var(--border); border-radius:var(--radius); }

    .tabs { display:flex; gap:.5em; flex-wrap:wrap; }
    .tab-btn {
      padding:.45em .9em; border-radius:999px; border:1px solid var(--border);
      cursor:pointer; background:#dff3f7; color:var(--text-main); font-weight:600; font-size:13px;
    }
    .tab-btn.active { background:var(--accent); color:#fff; border-color:var(--accent); }

    .summary { display:flex; gap:1em; flex-wrap:wrap; }
    .summary .resume-item { flex:1 1 180px; }

    .small { font-size:12px; color:var(--text-muted); }

    .chart-wrap { background:var(--bg-box); padding:1em; border-radius:var(--radius);
                  box-shadow:var(--shadow); border:1px solid var(--border); }
  </style>
</head>
<body>

  <div class="top-bar">
    <h1>üìä Tableau de bord</h1>
    <button class="btn btn-muted" onclick="window.location.href='/pages/home.html'">
      ‚Üê Retour accueil
    </button>
  </div>

  <!-- HEADER FILTRES -->
  <div class="box">
    <h2 style="margin-top:0;">Filtres d‚Äôaffichage</h2>

    <div class="tabs" id="modeTabs">
      <button class="tab-btn active" data-mode="day">Jour</button>
      <button class="tab-btn" data-mode="week">Semaine</button>
      <button class="tab-btn" data-mode="month">Mois</button>
      <button class="tab-btn" data-mode="year">Ann√©e</button>
      <button class="tab-btn" data-mode="custom">P√©riode</button>
    </div>

    <div class="row" style="margin-top:12px;" id="inputsRow">
      <!-- inputs inject√©s par JS -->
    </div>

    <div class="row" style="margin-top:12px;">
      <label>
        CA r√©el HT (Z)
        <input id="zCaHT" type="number" step="0.01" placeholder="Saisie du Z du jour">
      </label>

      <button id="btnSaveZ" class="btn btn-accent">üíæ Enregistrer le Z</button>

      <div class="small" style="align-self:center;">
        Le CA r√©el est utilis√© pour la marge. Le CA th√©orique reste une info de contr√¥le.
      </div>
    </div>

    <div id="status" class="small" style="margin-top:6px;"></div>
  </div>

  <!-- CARTES SYNTH√àSE -->
  <div class="header-box">
    <h2 style="margin-top:0;">Synth√®se p√©riode</h2>
    <div class="summary">
      <div class="resume-item">
        <h3>üìò CA r√©el HT</h3>
        <p><span id="sumCaReel">0.00</span> ‚Ç¨</p>
        <p class="small">Somme des Z saisis sur la p√©riode</p>
      </div>
      <div class="resume-item">
        <h3>üì¶ Achats consomm√©s HT</h3>
        <p><span id="sumAchatsConso">0.00</span> ‚Ç¨</p>
        <p class="small">Factures lettr√©es prioris√©es</p>
      </div>
      <div class="resume-item">
        <h3>üìâ Variation stock HT</h3>
        <p><span id="sumVarStock">0.00</span> ‚Ç¨</p>
        <p class="small">StockD√©but ‚Äì StockFin</p>
      </div>
      <div class="resume-item total">
        <h3>üí∂ Marge brute</h3>
        <p>
          <span id="sumMarge">0.00</span> ‚Ç¨ ‚Äì
          <span id="sumMargePct">0.0</span> %
        </p>
        <p class="small">CA r√©el ‚Äì Achats consomm√©s</p>
      </div>
    </div>
  </div>

  <!-- D√âTAILS -->
  <div class="box">
    <h2>D√©tails</h2>
    <table>
      <tbody>
        <tr><th>Stock d√©but HT</th><td id="stockDebut">0.00 ‚Ç¨</td></tr>
        <tr><th>Stock fin HT</th><td id="stockFin">0.00 ‚Ç¨</td></tr>
        <tr><th>Achats p√©riode HT</th><td id="achatsPeriode">0.00 ‚Ç¨</td></tr>
        <tr><th>Achats consomm√©s HT</th><td id="achatsConso">0.00 ‚Ç¨</td></tr>
        <tr><th>CA th√©orique HT</th><td id="caTheo">0.00 ‚Ç¨</td></tr>
        <tr><th>CA r√©el HT</th><td id="caReel">0.00 ‚Ç¨</td></tr>
      </tbody>
    </table>

    <div class="small" style="margin-top:8px;">
      Achats = somme des achats de la p√©riode, mais si une facture lettr√©e existe, elle remplace l‚Äôachat.
    </div>
  </div>

  <!-- GRAPHIQUES -->
  <div class="chart-wrap">
    <h2 style="margin-top:0;">Graphiques</h2>
    <canvas id="chartMain" height="110"></canvas>
  </div>

  <script type="module" src="../js/compta-dashboard.js"></script>
</body>
</html>
