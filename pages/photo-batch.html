<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>R√©ception ‚Äì Lots</title>

  <script type="module" src="../js/firebase-init.js"></script>
  <script type="module" src="../js/auth.js"></script>

  <style>
  body { font-family: sans-serif; padding:1rem; }

  .row {
    border:1px solid #ddd;
    padding:1rem;
    margin-bottom:.8rem;
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:1rem;
  }

  .row b {
    font-size:1.2rem;
  }

  button {
    padding:.6rem 1rem;
  }

  .mobile-btn {
    padding:1rem 1.4rem;
    font-size:1.2rem;
    border-radius:12px;
    background:#1293a9;
    color:white;
    border:none;
  }
</style>

</head>
<body>

<h2>üì¶ R√©ception ‚Äì Lots</h2>
<p id="achatInfo"></p>

<div id="list"></div>

<script type="module">
import { app, db } from "../js/firebase-init.js";

import {
  doc, getDoc, collection, getDocs
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const auth = getAuth();
await signInAnonymously(auth).catch(() => {});


const params = new URLSearchParams(location.search);
const achatId = params.get("achatId");
const achatRef = doc(db,"achats",achatId);

document.getElementById("achatInfo").textContent = "Achat : " + achatId;

const snap = await getDocs(collection(achatRef,"lignes"));

const list = document.getElementById("list");

snap.forEach(d => {
  const L = d.data();
  if (L.received) return;
  if (!L.plu) return;   // ‚¨ÖÔ∏è ignore les lignes sans PLU
  const div = document.createElement("div");
  div.className="row";

  div.innerHTML = `
    <div>
      <div style="font-size:1.2rem; font-weight:bold;">${L.plu || ""}</div>
<div>${L.designation || ""}</div>
<div style="margin-top:.2rem; color:#666;">${L.poidsTotalKg || ""} kg</div>
    </div>
    <button class="mobile-btn" data-id="${d.id}">üì∏ Photo</button>
  `;

  div.querySelector("button").addEventListener("click",()=>{
    location.href = `/pages/photo-line.html?achatId=${achatId}&lineId=${d.id}`;
  });

  list.appendChild(div);
});
</script>
</body>
</html>
