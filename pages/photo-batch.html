<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>R√©ception ‚Äì Lots</title>

  <script type="module" src="../js/firebase-init.js"></script>


  <style>
  body {
    font-family: sans-serif;
    padding: 1rem;
    background: #f5f5f5;
  }

  .row {
    border: 2px solid #aaa;
    border-radius: 14px;
    background: #fff;
    padding: 1.4rem;
    margin-bottom: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1.2rem;
  }

  .row-info {
    font-size: 1.4rem;
    line-height: 1.35;
  }

  .btn-photo {
    padding: 1.4rem 1.8rem;
    font-size: 1.5rem;
    border-radius: 14px;
    background: #0077ff;
    color: white;
    border: none;
  }

  .btn-photo:active {
    background: #0057bb;
  }
</style>


</head>
<body>

<h2>üì¶ R√©ception ‚Äì Lots</h2>
<p id="achatInfo"></p>

<div id="list"></div>

<script type="module">
import { app, db } from "../js/firebase-init.js";

import {
  doc, getDoc, collection, getDocs
} from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const auth = getAuth();
await signInAnonymously(auth).catch(() => {});


const params = new URLSearchParams(location.search);
const achatId = params.get("achatId");
const achatRef = doc(db,"achats",achatId);

document.getElementById("achatInfo").textContent = "Achat : " + achatId;

const snap = await getDocs(collection(achatRef,"lignes"));

const list = document.getElementById("list");

snap.forEach(d => {
  const L = d.data();
  if (L.received) return;
  if (!L.plu) return;   // ‚¨ÖÔ∏è ignore les lignes sans PLU
  const div = document.createElement("div");
  div.className="row";

  div.innerHTML = `
    <div>
      <div style="font-size:1.2rem; font-weight:bold;">${L.plu || ""}</div>
<div>${L.designation || ""}</div>
<div style="margin-top:.2rem; color:#666;">${L.poidsTotalKg || ""} kg</div>
    </div>
    <button class="btn-photo" data-id="${d.id}">
  üì∏ Prendre photo
</button>
  `;

  div.querySelector("button").addEventListener("click",()=>{
    location.href = `/pages/photo-line.html?achatId=${achatId}&lineId=${d.id}`;
  });

  list.appendChild(div);
});
</script>
</body>
</html>
