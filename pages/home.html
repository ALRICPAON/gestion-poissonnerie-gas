<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="../css/styles.css">
<title>Gestion Poissonnerie</title>

</head>
<body>
  <header id="topbar"></header>
  <main class="container">
    <h2 class="page-title">Accueil</h2>

<!-- Bouton g√©n√©ration QR (coller ici) -->
<div style="margin:10px 0;">
  <button id="btnGenQR" class="btn btn-accent" style="vertical-align:middle;">
    üì± G√©n√©rer QR d'acc√®s Entrep√¥t
  </button>
</div>

    <div class="cards">
  <a class="card" href="./articles.html">
    <h3>Articles</h3>
    <p>Catalogue articles (PLU, d√©signation, allerg√®nes...)</p>
  </a>

  <a class="card" href="./fournisseurs.html">
    <h3>Fournisseurs</h3>
    <p>Contacts, codes, pr√©f√©rences par fournisseur</p>
  </a>

  <a class="card" href="./af-map.html">
    <h3>Article ‚Üî Fournisseur</h3>
    <p>Mapping PLU / R√©f fournisseur / alias</p>
  </a>

  <a class="card" href="./achats.html">
    <h3>Achats</h3>
    <p>Saisies, import BL, sous-totaux, r√©ception</p>
  </a>

  <a class="card" href="./stock.html">
    <h3>Stock</h3>
    <p>CUMP, PV choisis, marges, √©carts</p>
  </a>

  <a class="card" href="./inventaire.html">
    <h3>Inventaire</h3>
    <p>Par poids ou CA TTC, validation</p>
  </a>

  <a class="card" href="./tracabilite.html">
    <h3>Tra√ßabilit√©</h3>
    <p>Lots, zones FAO, engins, journal des mouvements</p>
  </a>
      
<!-- ADMIN: acc√®s gestion utilisateurs (visible uniquement aux admins) -->
<a id="admin-card" class="card" href="./admin-users.html" style="display:none;">
  <h3>Admin ‚Äî Utilisateurs</h3>
  <p>Cr√©er / g√©rer les utilisateurs & leurs modules</p>
</a>


  <a class="card" href="./transformations.html">
    <h3>Transformations</h3>
    <p>Consommation/production de lots (FIFO)</p>
  </a>

  <a class="card" href="./plateaux.html">
    <h3>Plateaux</h3>
    <p>Mod√®les de plateaux + vente FIFO multi-PLU</p>
  </a>

  <a class="card" href="./etiquettes.html">
    <h3>√âtiquettes</h3>
    <p>Pr√©parer / Exporter √©tiquettes (.xlsx)</p>
  </a>

  <!-- üÜï MODULE COMPTABILIT√â -->
  <a class="card" href="./compta.html">
    <h3>üìò Comptabilit√©</h3>
    <p>Lettrage factures ‚Ä¢ Dashboard ‚Ä¢ Statistiques</p>
  </a>
</div>

  </main>

  <script type="module" src="../js/firebase-init.js"></script>
  <script type="module" src="../js/auth.js"></script>
  <script type="module" src="../js/menu.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => { window.__requireAuth && window.__requireAuth(); });
  </script>
  <script type="module">
  // adapter le chemin selon l'emplacement du fichier (ici la page est dans /pages/)
  import { auth, db } from '../js/firebase-init.js';
  import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js';
  import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js';

  const adminCard = document.getElementById('admin-card');
  // s√©curit√© : si l'√©l√©ment n'existe pas, on stoppe
  if (!adminCard) {
    console.warn('admin-card non trouv√© dans la page');
  } else {
    // √âcoute l'√©tat d'auth
    onAuthStateChanged(auth, async (user) => {
      try {
        if (!user) {
          // non connect√© ‚Üí masquer
          adminCard.style.display = 'none';
          return;
        }
        // R√©cup√®re le doc app_users/{uid}
        const snap = await getDoc(doc(db, 'app_users', user.uid));
        if (snap.exists() && snap.data()?.role === 'admin') {
          adminCard.style.display = 'block';
        } else {
          adminCard.style.display = 'none';
        }
      } catch (err) {
        console.error('Erreur v√©rif admin:', err);
        adminCard.style.display = 'none';
      }
    });
  }
</script>

  <!-- QR lib (QRCode.js) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- Script custom pour g√©n√©rer et g√©rer la modal QR -->
<script src="../js/home-qr.js"></script>


</body>
</html>
