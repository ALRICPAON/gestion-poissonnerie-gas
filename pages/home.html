<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="../css/styles.css">
<title>Gestion Poissonnerie</title>

</head>
<body>
  <header id="topbar"></header>
  <main class="container">
    <h2 class="page-title">Accueil</h2>

<!-- Bouton gÃ©nÃ©ration QR (coller ici) -->
<div style="margin:10px 0;">
  <button id="btnGenQR" class="btn btn-accent" style="vertical-align:middle;">
    ğŸ“± GÃ©nÃ©rer QR d'accÃ¨s EntrepÃ´t
  </button>
</div>

    <div class="cards">
  <a class="card" href="./articles.html">
    <h3>Articles</h3>
    <p>Catalogue articles (PLU, dÃ©signation, allergÃ¨nes...)</p>
  </a>

  <a class="card" href="./fournisseurs.html">
    <h3>Fournisseurs</h3>
    <p>Contacts, codes, prÃ©fÃ©rences par fournisseur</p>
  </a>

  <a class="card" href="./af-map.html">
    <h3>Article â†” Fournisseur</h3>
    <p>Mapping PLU / RÃ©f fournisseur / alias</p>
  </a>

  <a class="card" href="./achats.html">
    <h3>Achats</h3>
    <p>Saisies, import BL, sous-totaux, rÃ©ception</p>
  </a>

  <a class="card" href="./stock.html">
    <h3>Stock</h3>
    <p>CUMP, PV choisis, marges, Ã©carts</p>
  </a>

  <a class="card" href="./inventaire.html">
    <h3>Inventaire</h3>
    <p>Par poids ou CA TTC, validation</p>
  </a>

  <a class="card" href="./tracabilite.html">
    <h3>TraÃ§abilitÃ©</h3>
    <p>Lots, zones FAO, engins, journal des mouvements</p>
  </a>
      
<!-- ADMIN: accÃ¨s gestion utilisateurs (visible uniquement aux admins) -->
<a id="admin-card" class="card" href="./admin-users.html" style="display:none;">
  <h3>Admin â€” Utilisateurs</h3>
  <p>CrÃ©er / gÃ©rer les utilisateurs & leurs modules</p>
</a>


  <a class="card" href="./transformations.html">
    <h3>Transformations</h3>
    <p>Consommation/production de lots (FIFO)</p>
  </a>

  <a class="card" href="./plateaux.html">
    <h3>Plateaux</h3>
    <p>ModÃ¨les de plateaux + vente FIFO multi-PLU</p>
  </a>

  <a class="card" href="./etiquettes.html">
    <h3>Ã‰tiquettes</h3>
    <p>PrÃ©parer / Exporter Ã©tiquettes (.xlsx)</p>
  </a>

  <!-- ğŸ†• MODULE COMPTABILITÃ‰ -->
  <a class="card" href="./compta.html">
    <h3>ğŸ“˜ ComptabilitÃ©</h3>
    <p>Lettrage factures â€¢ Dashboard â€¢ Statistiques</p>
  </a>
</div>

  </main>

  <script type="module" src="../js/firebase-init.js"></script>
  <script type="module" src="../js/auth.js"></script>
  <script type="module" src="../js/menu.js"></script>
  <script>
    window.addEventListener('DOMContentLoaded', () => { window.__requireAuth && window.__requireAuth(); });
  </script>
  <script type="module">
  // adapter le chemin selon l'emplacement du fichier (ici la page est dans /pages/)
  import { auth, db } from '../js/firebase-init.js';
  import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js';
  import { doc, getDoc } from 'https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js';

  const adminCard = document.getElementById('admin-card');
  // sÃ©curitÃ© : si l'Ã©lÃ©ment n'existe pas, on stoppe
  if (!adminCard) {
    console.warn('admin-card non trouvÃ© dans la page');
  } else {
    // Ã‰coute l'Ã©tat d'auth
    onAuthStateChanged(auth, async (user) => {
      try {
        if (!user) {
          // non connectÃ© â†’ masquer
          adminCard.style.display = 'none';
          return;
        }
        // RÃ©cupÃ¨re le doc app_users/{uid}
        const snap = await getDoc(doc(db, 'app_users', user.uid));
        if (snap.exists() && snap.data()?.role === 'admin') {
          adminCard.style.display = 'block';
        } else {
          adminCard.style.display = 'none';
        }
      } catch (err) {
        console.error('Erreur vÃ©rif admin:', err);
        adminCard.style.display = 'none';
      }
    });
  }
</script>

  <!-- QR lib (QRCode.js) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <!-- QR lib (QRCode.js) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<!-- jsPDF (pour gÃ©nÃ©rer PDF cÃ´tÃ© client) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- Script custom pour gÃ©nÃ©rer et tÃ©lÃ©charger le PDF du QR -->
<script src="../js/home-qr.js"></script>


<!-- Script custom pour gÃ©nÃ©rer et gÃ©rer la modal QR -->
<script src="../js/home-qr.js"></script>
<!-- QR Modal (Ã  coller avant </body>) -->
<div id="qr-modal" class="qr-modal" aria-hidden="true" style="display:none; align-items:center; justify-content:center;">
  <div class="qr-modal-content" role="dialog" aria-modal="true" aria-labelledby="qr-title" style="background:#fff;padding:16px;border-radius:10px;width:360px;max-width:94%;box-shadow:0 8px 30px rgba(0,0,0,0.25);text-align:center;">
    <h3 id="qr-title" style="margin:0 0 8px 0;">AccÃ¨s EntrepÃ´t</h3>

    <div id="qr-container" class="qr-box" style="width:256px;height:256px;margin:12px auto;"></div>

    <div class="qr-actions" style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin-top:8px;">
      <button id="qr-download" class="btn">â¬‡ï¸ TÃ©lÃ©charger</button>
      <button id="qr-copy" class="btn btn-muted">ğŸ“‹ Copier URL</button>
      <a id="qr-open" class="btn btn-accent" href="https://gestion-poissonnerie-gas.netlify.app/pages/home.html" target="_blank" rel="noopener">ğŸ”— Ouvrir</a>
      <button id="qr-close" class="btn btn-small btn-muted">Fermer</button>
    </div>

    <div class="qr-url" style="margin-top:10px;color:#666;font-size:13px;word-break:break-all;">
      <small>URL : <code>https://gestion-poissonnerie-gas.netlify.app/pages/home.html</code></small>
    </div>
  </div>
</div>


</body>
</html>
